<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Spotify Bypass Podcast</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 40px; }
        .container { max-width: 600px; margin: auto; }
        #status { margin-top: 20px; font-weight: bold; min-height: 20px; }
        progress { width: 100%; margin-top: 10px; }

        /*  버튼 스타일 추가  */
        .button {
            display: inline-block;
            background-color: #1DB954; /* Spotify Green */
            color: white;
            padding: 10px 15px;
            text-decoration: none;
            border-radius: 50px;
            font-weight: bold;
            margin-top: 15px;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .button:hover {
            background-color: #1ED760;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>Spotify Podcast 우회 도우미</h1>
        <p>음악 파일에 1분 무음을 추가하여 Podcast로 업로드할 수 있게 변환합니다.</p>
        
        <input type="file" id="uploader">

        <br>
        <a href="https://creators.spotify.com/" target="_blank" class="button">Spotify Podcasts 로 바로가기</a>
        <p id="status">파일을 선택해주세요.</p>
        <progress id="progressBar" value="0" max="100" style="display: none;"></progress>
    </div>

    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>

    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        const statusEl = document.getElementById('status');
        const uploader = document.getElementById('uploader');
        const progressBar = document.getElementById('progressBar');

        const ffmpeg = createFFmpeg({
            log: true,
            progress: ({ ratio }) => {
                const percentage = Math.round(ratio * 100);
                if (percentage > 0 && percentage <= 100) {
                    statusEl.textContent = `변환 중: ${percentage}%`;
                    progressBar.value = percentage;
                    progressBar.style.display = 'block';
                }
            }
        });

        uploader.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            statusEl.textContent = '엔진 로딩 중...';
            progressBar.style.display = 'none';
            uploader.disabled = true;
            
            if (!ffmpeg.isLoaded()) {
                await ffmpeg.load();
            }
            
            statusEl.textContent = '파일을 메모리에 쓰는 중입니다...';
            const { name } = file;
            const namePart = name.slice(0, name.lastIndexOf('.'));
            const extPart = name.slice(name.lastIndexOf('.'));
            const outputName = `${namePart}_bypass_spotify${extPart}`;

            ffmpeg.FS('writeFile', name, await fetchFile(file));

            statusEl.textContent = '변환을 시작합니다...';
            
            await ffmpeg.run(
                '-f', 'lavfi', '-t', '60', '-i', 'anullsrc=r=44100:cl=stereo',
                '-i', name,
                '-filter_complex', '[0:a][1]concat=n=2:v=0:a=1',
                outputName
            );

            statusEl.textContent = '작업 완료! 다운로드를 준비합니다...';
            progressBar.style.display = 'none';
            
            const data = ffmpeg.FS('readFile', outputName);
            const blob = new Blob([data.buffer], { type: 'audio/mpeg' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = outputName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            statusEl.textContent = '다운로드가 시작되었습니다! 파일을 확인해주세요.';
            uploader.disabled = false;
            uploader.value = '';
        });
    </script>
</body>
</html>

